"use strict";(self.webpackChunkterranetes=self.webpackChunkterranetes||[]).push([["5198"],{8803:function(e,n,t){t.r(n),t.d(n,{metadata:()=>s,contentTitle:()=>o,default:()=>h,assets:()=>l,toc:()=>c,frontMatter:()=>r});var s=JSON.parse('{"id":"admin/defaults","title":"Injecting Defaults","description":"Through the implementation of policies, platform administrators are empowered to inject both variables and secrets into developer Configurations, addressing key use cases such as:","source":"@site/docs/terranetes-controller/admin/defaults.md","sourceDirName":"admin","slug":"/admin/defaults","permalink":"/terranetes-controller/admin/defaults","draft":false,"unlisted":false,"editUrl":"https://github.com/appvia/terranetes/tree/master/docs/terranetes-controller/admin/defaults.md","tags":[],"version":"current","lastUpdatedBy":"dependabot[bot]","lastUpdatedAt":1745161406000,"sidebarPosition":5,"frontMatter":{"sidebar_position":5},"sidebar":"tutorialSidebar","previous":{"title":"Expose Costs","permalink":"/terranetes-controller/admin/costs"},"next":{"title":"Drift Detection","permalink":"/terranetes-controller/admin/drift"}}'),a=t("5893"),i=t("65");let r={sidebar_position:5},o="Injecting Defaults",l={},c=[{value:"Variables",id:"variables",level:2},{value:"Secrets",id:"secrets",level:2}];function d(e){let n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.a)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"injecting-defaults",children:"Injecting Defaults"})}),"\n",(0,a.jsx)(n.p,{children:"Through the implementation of policies, platform administrators are empowered to inject both variables and secrets into developer Configurations, addressing key use cases such as:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Mitigating the administrative burden on developers by standardizing the values to be used or enforcing specific organizational defaults on upstream modules."}),"\n",(0,a.jsx)(n.li,{children:"Facilitating the sharing of credentials and tokens across a collection of Configurations, exemplified by access to private repositories."}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"variables",children:"Variables"}),"\n",(0,a.jsx)(n.p,{children:"The default environment enables the injection of environment-specific variables into a configuration, contingent upon a selector. This capability is particularly useful for:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Incorporating environment-specific parameters (such as VPC ID, tags, etc.), thereby alleviating the need for developers to manage these details"}),"\n",(0,a.jsx)(n.li,{children:"Assigning project-specific tags (like cost center codes, project ID, etc.), ensuring consistency across configurations"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"To implement these variables, a Policy resource can be utilized. A sample configuration is provided below:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"apiVersion: terraform.appvia.io/v1alpha1\nkind: Policy\nmetadata:\n  name: environment-defaults\nspec:\n  defaults:\n    # Can be used to filter on configuration module sources\n    modules:\n      - <REGEX>\n    namespace:\n      # Match on namespace labels\n      matchLabels:\n        kubernetes.io/metadata.name: hello\n      # Use expressions to match on namespace labels\n      matchExpressions:\n        - key: kubernetes.io/metadata.name\n          operator: Exists\n    variables:\n      environment: dev\n"})}),"\n",(0,a.jsx)(n.h2,{id:"secrets",children:"Secrets"}),"\n",(0,a.jsx)(n.admonition,{type:"tip",children:(0,a.jsx)(n.p,{children:"This feature is only available from v0.3.15 onwards"})}),"\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.code,{children:"defaults"})," policy offers the capability to inject secrets into a job, facilitating transparent authentication for the platform team. A typical scenario for this feature involves the following:"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"The organization has a collection of private repositories that are intended for consumption by developers."}),"\n",(0,a.jsx)(n.li,{children:"To ensure a seamless experience for developers, the authentication process for these modules should be transparent, eliminating the need for them to handle authentication directly."}),"\n",(0,a.jsx)(n.li,{children:"A Kubernetes secret has been created within the controller namespace, containing either an SSH key or a personal access token, which is utilized for sourcing the modules."}),"\n",(0,a.jsx)(n.li,{children:"It is necessary to configure a policy that injects these secrets into the job, thereby alleviating the need for developers to manage private authentication processes themselves."}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"apiVersion: terraform.appvia.io/v1alpha1\nkind: Policy\nmetadata:\n  name: default-authentication\nspec:\n  defaults:\n    # Can be used to filter on configuration module sources\n    modules:\n      - github.com/appvia/terraform-aws-myprivaterepo:.*\n    namespace:\n      # Use expressions to match on namespace labels\n      matchExpressions:\n        - key: kubernetes.io/metadata.name\n          operator: Exists\n    secrets:\n      - auth_key\n"})}),"\n",(0,a.jsx)(n.admonition,{type:"caution",children:(0,a.jsxs)(n.p,{children:["Please be aware that prior to version v0.3.30, the terranetes controller had a bug related to default secrets. During the ",(0,a.jsx)(n.code,{children:"setup"})," stage, which is responsible for retrieving the ",(0,a.jsx)(n.code,{children:"spec.module"})," (terraform code), the secret was not accessible. This could lead to issues, especially when using the feature to support private repository access, as it could cause problems during deletion. This issue has been resolved and the fix can be found ",(0,a.jsx)(n.a,{href:"https://github.com/appvia/terranetes-controller/pull/812",children:"here"})]})})]})}function h(e={}){let{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},65:function(e,n,t){t.d(n,{Z:function(){return o},a:function(){return r}});var s=t(7294);let a={},i=s.createContext(a);function r(e){let n=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);