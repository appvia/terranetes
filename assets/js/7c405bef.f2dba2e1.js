"use strict";(self.webpackChunkterraform_controller_docs=self.webpackChunkterraform_controller_docs||[]).push([[5610],{3905:function(e,t,n){n.d(t,{Zo:function(){return d},kt:function(){return m}});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=r.createContext({}),c=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},d=function(e){var t=c(e.components);return r.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},p=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,l=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),p=c(n),m=a,h=p["".concat(l,".").concat(m)]||p[m]||u[m]||o;return n?r.createElement(h,i(i({ref:t},d),{},{components:n})):r.createElement(h,i({ref:t},d))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=p;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:a,i[1]=s;for(var c=2;c<o;c++)i[c]=n[c];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}p.displayName="MDXCreateElement"},1750:function(e,t,n){n.r(t),n.d(t,{assets:function(){return d},contentTitle:function(){return l},default:function(){return m},frontMatter:function(){return s},metadata:function(){return c},toc:function(){return u}});var r=n(7462),a=n(3366),o=(n(7294),n(3905)),i=["components"],s={sidebar_position:1},l="Terranetes CLI",c={unversionedId:"developer/tnctl",id:"developer/tnctl",title:"Terranetes CLI",description:"Terranetes comes bundled with a tnctl command (see Releases for downloads) which has ability to search for cloud resources. The search subcommand supports iterating through",source:"@site/docs/terranetes-controller/developer/tnctl.md",sourceDirName:"developer",slug:"/developer/tnctl",permalink:"/terranetes-controller/developer/tnctl",draft:!1,editUrl:"https://github.com/appvia/terranetes/tree/master/docs/terranetes-controller/developer/tnctl.md",tags:[],version:"current",lastUpdatedBy:"Kashif Saadat",lastUpdatedAt:1661348123,formattedLastUpdatedAt:"8/24/2022",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"Provisioning a Terraform Module",permalink:"/terranetes-controller/developer/configuration"},next:{title:"Using Private Repositories",permalink:"/terranetes-controller/developer/private"}},d={},u=[{value:"How to search",id:"how-to-search",level:2},{value:"Adding Sources",id:"adding-sources",level:2},{value:"Adding your Github organization",id:"adding-your-github-organization",level:3},{value:"Adding the Terraform Registry",id:"adding-the-terraform-registry",level:3},{value:"Integrate with Kubectl",id:"integrate-with-kubectl",level:2},{value:"Watching Logs",id:"watching-logs",level:2},{value:"Describing Configurations",id:"describing-configurations",level:2}],p={toc:u};function m(e){var t=e.components,n=(0,a.Z)(e,i);return(0,o.kt)("wrapper",(0,r.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"terranetes-cli"},"Terranetes CLI"),(0,o.kt)("p",null,"Terranetes comes bundled with a ",(0,o.kt)("a",{parentName:"p",href:"/terranetes-controller/cli/tnctl"},"tnctl")," command ",(0,o.kt)("em",{parentName:"p"},"(see ",(0,o.kt)("a",{parentName:"em",href:"/terranetes-controller/releases"},"Releases")," for downloads)")," which has ability to search for cloud resources. The ",(0,o.kt)("a",{parentName:"p",href:"/terranetes-controller/cli/tnctl_search"},"search")," subcommand supports iterating through"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://registry.terraform.io"},"Terraform registry"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://github.com"},"Github")," repositories and releases of any organization and or user.")),(0,o.kt)("h2",{id:"how-to-search"},"How to search"),(0,o.kt)("p",null,"Once one or more sources have been configured you can search for cloud resources via"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"tnctl search [TERMS]\n")),(0,o.kt)("p",null,"Looking for a ",(0,o.kt)("inlineCode",{parentName:"p"},"database")," module on ",(0,o.kt)("inlineCode",{parentName:"p"},"aws"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"$ tnctl search database\n? What cloud provider should we scope the search to? aws\n? Which resource do you want to provision?\n  \u25b8[TF] terraform-aws-modules/dms\n   [TF] babbel/secretsmanager-for-database-url\n   [TF] terraform-aws-modules/dms\n   [TF] connect-group/rds-finalsnapshot\n   [TF] azavea/postgresql-rds\n   [TF] franviera92/aurora\n   [TF] bridgecrewio/secured-postgresql-rds\n   [TF] felipefrizzo/rds-mysql\n   [TF] felipefrizzo/rds-postgres\n   [TF] devops4me/postgres-rds\n   [TF] jessiehernandez/autorotated-database-credentials\n   [TF] mnanchev/database-migration-service\n   [TF] aleks-fofanov/rds-lambda-db-provisioner\n   [TF] jessiehernandez/database-credentials-rotator\n\u2193  [TF] offensive-terraform/rds-snapshot-publicly-exposed\n\nName:       dms\nNamespace:  terraform-aws-modules\nModule:     https://github.com/terraform-aws-modules/terraform-aws-dms\nSource:     https://registry.terraform.io/namespaces/terraform-aws-modules\nCreated:    2022-06-23 17:41:50.716218 +0000 UTC\nDownloads:  16436\n\nTerraform module which creates AWS DMS (Database Migration Service) resources\n")),(0,o.kt)("p",null,"Next you will be prompted to choose the"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Tagged version"),(0,o.kt)("li",{parentName:"ul"},"Asked for any ",(0,o.kt)("strong",{parentName:"li"},"required")," inputs ",(0,o.kt)("em",{parentName:"li"},"(i.e. names, storages size and so forth)"))),(0,o.kt)("p",null,"The final piece will render a ",(0,o.kt)("a",{parentName:"p",href:"/terranetes-controller/reference/configurations.terraform.appvia.io"},"Configuration")," CRD ready to be consumed in your deployment pipeline."),(0,o.kt)("h2",{id:"adding-sources"},"Adding Sources"),(0,o.kt)("p",null,"You can add a source to the ",(0,o.kt)("a",{parentName:"p",href:"/terranetes-controller/cli/tnctl"},"tnctl")," command via ",(0,o.kt)("a",{parentName:"p",href:"/terranetes-controller/cli/tnctl_config_sources"},"tnctl config sources")," command. For example to add"),(0,o.kt)("h3",{id:"adding-your-github-organization"},"Adding your Github organization"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"tnctl config sources add https://github.com/appvia\n")),(0,o.kt)("div",{className:"admonition admonition-important alert alert--info"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"important")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"If any of the terraform modules are in private repositories you must export your Github token via export GITHUB_TOKEN=TOKEN"))),(0,o.kt)("h3",{id:"adding-the-terraform-registry"},"Adding the Terraform Registry"),(0,o.kt)("p",null,"You can add the Terraform registry via"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"tnctl config sources add https://registry.terraform.io\n")),(0,o.kt)("p",null,"Alternately you can scope the registry to a specific namespace"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"tnctl config sources add https://registry.terraform.io/namespaces/terraform-aws-modules\n")),(0,o.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"You can add as many sources are you needs. The ",(0,o.kt)("a",{parentName:"p",href:"/terranetes-controller/cli/tnctl_search"},"search")," will aggregate the results and present it findings as one."))),(0,o.kt)("h2",{id:"integrate-with-kubectl"},"Integrate with Kubectl"),(0,o.kt)("p",null,"You can integrate tnctl with Kubectl i.e. ",(0,o.kt)("inlineCode",{parentName:"p"},"kubectl tnctl COMMAND"),"."),(0,o.kt)("div",{className:"admonition admonition-important alert alert--info"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"important")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"Kubectl can recognize plugins based on the name. Lets assume you place an executable script in your ",(0,o.kt)("inlineCode",{parentName:"p"},"$PATH")," named ",(0,o.kt)("inlineCode",{parentName:"p"},"kubectl-hello-world"),". This script can be called via ",(0,o.kt)("inlineCode",{parentName:"p"},"$ kubectl hello world"),". All the ",(0,o.kt)("inlineCode",{parentName:"p"},"tnctl kubectl plugin")," does it create an collection of these alias scripts i.e kubectl-tnctl-describe, kubectl-tnctl-logs and so forth in the desired location."))),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Run the ",(0,o.kt)("inlineCode",{parentName:"li"},"tnctl kubectl plugin -d DIRECTORY")," command. The directory here is the location of where the alias scripts should be located."),(0,o.kt)("li",{parentName:"ol"},"Ensure the alias scripts are included in your environment ",(0,o.kt)("inlineCode",{parentName:"li"},"$PATH")),(0,o.kt)("li",{parentName:"ol"},"Ensure the ",(0,o.kt)("inlineCode",{parentName:"li"},"tnctl")," is included in your environment ",(0,o.kt)("inlineCode",{parentName:"li"},"$PATH"),"."),(0,o.kt)("li",{parentName:"ol"},"You can now use kubectl directory ",(0,o.kt)("em",{parentName:"li"},"(note tab completion is configured via kubectl, please review their docs)"),".")),(0,o.kt)("h2",{id:"watching-logs"},"Watching Logs"),(0,o.kt)("p",null,"When a Configuration is run a pod is created in the namespace used to watch the logs. You can perform the"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Retrieve the pods via ",(0,o.kt)("inlineCode",{parentName:"li"},"kubectl get pods")),(0,o.kt)("li",{parentName:"ol"},"Find the appropriate pod based on the Configuration name and generation."),(0,o.kt)("li",{parentName:"ol"},"Watch the logs via ",(0,o.kt)("inlineCode",{parentName:"li"},"kubectl logs NAME -f"))),(0,o.kt)("p",null,"A faster alternative is to use the ","[logs]","(/terranetes-controller/cli/tnctl_logs]"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Type ",(0,o.kt)("inlineCode",{parentName:"li"},"tnctl logs -n NAMESPACE NAME [-f--follow]")),(0,o.kt)("li",{parentName:"ol"},"If the kubectl plugin integration has been enabled, you can use ",(0,o.kt)("inlineCode",{parentName:"li"},"kubectl tnctl logs [-n NAMESPACE] NAME [-f|--follow]"))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},'$ tnctl logs -n apps bucket -f\n[info] waiting for the job to be scheduled\n[info] watching build: bucket, generation: 1 for the job to be scheduled\n........\n=======================================================\n\'SETTING UP THE ENVIRONMENT\'\n=======================================================\ntime="2022-08-09T09:59:37Z" level=info msg="downloading the assets" dest=/data source="https://github.com/terraform-aws-modules/terraform-aws-s3-bucket.git?ref=v3.1.0"\ntime="2022-08-09T09:59:38Z" level=info msg="successfully downloaded the source" source="https://github.com/terraform-aws-modules/terraform-aws-s3-bucket.git?ref=v3.1.0"\ntime="2022-08-09T09:59:38Z" level=info msg="successfully executed the step"\n\nInitializing the backend...\n\nSuccessfully configured the backend "kubernetes"! Terraform will automatically\nuse this backend unless the backend configuration changes.\n...\n')),(0,o.kt)("h2",{id:"describing-configurations"},"Describing Configurations"),(0,o.kt)("p",null,"You can the use"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("inlineCode",{parentName:"li"},"tnctl describe -n NAMESPACE [NAME]")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("inlineCode",{parentName:"li"},"kubectl tnctl describe [-n NAMESPACE] [NAME]"))),(0,o.kt)("p",null,"to provide insight into costs and policy."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"[jest@starfury terranetes-controller]$ bin/tnctl describe -n apps bucket\nName:         bucket\nNamespace:    apps\nCreated:      2022-08-09T09:59:28Z\nStatus:       OutOfSync\nAnnotations:\n              terraform.appvia.io/apply    false\nLabels:       None\n\nConditions:\n==========\nName               Reason             Message\nProvider ready     Ready              Provider ready\nTerraform Plan     Ready              Terraform plan is complete\nSecurity Policy    ActionRequired     Configuration has failed security policy, refusing to continue\nTerraform Apply    ActionRequired     Waiting for terraform apply annotation to be set to true\nReady              NotDetermined\n\nConfiguration:\n=============\nAuthentication: None\nModule:         https://github.com/terraform-aws-modules/terraform-aws-s3-bucket.git?ref=v3.1.0\nProvider:       aws\nSecret:         apps/test\n\nCheckov Security Policy:\n=======================\nStatus:         Configuration has passed 11 and failed on 3 checks.\n\nCKV_AWS_18     FAILED\n\u251c\u2500 Name:       Ensure the S3 bucket has access logging enabled\n\u251c\u2500 Resource:   aws_s3_bucket.this[0]\n\u2514\u2500 Guide:      https://docs.bridgecrew.io/docs/s3_13-enable-logging\nCKV_AWS_144    FAILED\n\u251c\u2500 Name:       Ensure that S3 bucket has cross-region replication enabled\n\u251c\u2500 Resource:   aws_s3_bucket.this[0]\n\u2514\u2500 Guide:      https://docs.bridgecrew.io/docs/ensure-that-s3-bucket-has-cross-region-replication-enabled\n...\n")))}m.isMDXComponent=!0}}]);