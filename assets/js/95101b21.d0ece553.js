"use strict";(self.webpackChunkterranetes=self.webpackChunkterranetes||[]).push([["6185"],{3400:function(e,n,t){t.r(n),t.d(n,{metadata:()=>o,contentTitle:()=>s,default:()=>p,assets:()=>l,toc:()=>c,frontMatter:()=>a});var o=JSON.parse('{"id":"admin/policy/modules","title":"Module Restrictions","description":"You can control the source of the terraform modules permitted to run through the Policy resource. The following policy enforces that only modules sourced from the Appvia Github Organization can be used.","source":"@site/docs/terranetes-controller/admin/policy/modules.md","sourceDirName":"admin/policy","slug":"/admin/policy/modules","permalink":"/terranetes-controller/admin/policy/modules","draft":false,"unlisted":false,"editUrl":"https://github.com/appvia/terranetes/tree/master/docs/terranetes-controller/admin/policy/modules.md","tags":[],"version":"current","lastUpdatedBy":"dependabot[bot]","lastUpdatedAt":1745161575000,"sidebarPosition":2,"frontMatter":{"sidebar_position":2,"sidebar_class_name":"green"},"sidebar":"tutorialSidebar","previous":{"title":"Introduction","permalink":"/terranetes-controller/admin/policy/intro"},"next":{"title":"Checkov Policy","permalink":"/terranetes-controller/admin/policy/checkov"}}'),r=t("5893"),i=t("65");let a={sidebar_position:2,sidebar_class_name:"green"},s="Module Restrictions",l={},c=[];function d(e){let n={a:"a",admonition:"admonition",code:"code",h1:"h1",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,i.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"module-restrictions",children:"Module Restrictions"})}),"\n",(0,r.jsxs)(n.p,{children:["You can control the source of the terraform modules permitted to run through the ",(0,r.jsx)(n.a,{href:"/terranetes-controller/reference/policies.terraform.appvia.io",children:"Policy"})," resource. The following policy enforces that only modules sourced from the Appvia Github Organization can be used."]}),"\n",(0,r.jsx)(n.admonition,{type:"important",children:(0,r.jsxs)(n.p,{children:["This control is applied to the primary module (i.e. ",(0,r.jsx)(n.code,{children:"spec.module"}),") inside the Configuration CRD. Modules that incorporate other modules are not enforced."]})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'apiVersion: terraform.appvia.io/v1alpha1\nkind: Policy\nmetadata:\n  name: permitted-modules\nspec:\n  constraints:\n    modules:\n      selector:\n        namespace:\n          matchLabels: {}\n          matchExpressions: []\n        resource:\n          matchLabels: {}\n          matchExpressions: []\n      allowed:\n        - "https://github.com/appvia/.*"  # only allow specific org modules\n'})}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"spec.constraints.modules.allowed"})," list comprises a collection of Golang regex patterns that a ",(0,r.jsx)(n.a,{href:"/terranetes-controller/reference/configurations.terraform.appvia.io",children:"Configuration"})," must match at least one of."]}),"\n",(0,r.jsxs)(n.p,{children:["Additionally, the policy can optionally include a ",(0,r.jsx)(n.code,{children:"spec.constraints.modules.selector"})," that enables matching against namespace and resource labels of the ",(0,r.jsx)(n.a,{href:"/terranetes-controller/reference/configurations.terraform.appvia.io",children:"Configuration"}),". Consistent with all selectors within the controller, an empty field implies a match against all configurations. By providing specific overrides, you can leverage the selectors to target specific configurations."]}),"\n",(0,r.jsx)(n.p,{children:"The following example policy configurations are designed to meet the specified requirements:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Permit all teams to utilize terraform modules from the company's Github repositories at ",(0,r.jsx)(n.a,{href:"https://github.com/appvia",children:"https://github.com/appvia"})]}),"\n",(0,r.jsxs)(n.li,{children:["Allow teams operating within the ",(0,r.jsx)(n.code,{children:"infra"})," and ",(0,r.jsx)(n.code,{children:"ci"})," namespaces to access additional modules from ",(0,r.jsx)(n.a,{href:"https://github.com/elsewhere",children:"https://github.com/elsewhere"})]}),"\n"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Establish the default policy (i.e., without a selector)"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'apiVersion: terraform.appvia.io/v1alpha1\nkind: Policy\nmetadata:\n  name: default\nspec:\n  constraints:\n    modules:\n      allowed:\n        - "https://github.com/appvia/.*"\n'})}),"\n",(0,r.jsxs)(n.ol,{start:"2",children:["\n",(0,r.jsxs)(n.li,{children:["Create an additional policy specifically for the ",(0,r.jsx)(n.code,{children:"infra"})," and ",(0,r.jsx)(n.code,{children:"ci"})," namespaces."]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'apiVersion: terraform.appvia.io/v1alpha1\nkind: Policy\nmetadata:\n  name: default\nspec:\n  constraints:\n    modules:\n      selector:\n        namespace:\n          matchExpressions:\n            - key: kubernetes.io/metadata.name\n              operator: In\n              values: [infra, ci]\n      allowed:\n        - "https://github.com/elsewhere/.*"\n'})})]})}function p(e={}){let{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},65:function(e,n,t){t.d(n,{Z:function(){return s},a:function(){return a}});var o=t(7294);let r={},i=o.createContext(r);function a(e){let n=o.useContext(i);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),o.createElement(i.Provider,{value:n},e.children)}}}]);