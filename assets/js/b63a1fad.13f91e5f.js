"use strict";(self.webpackChunkterranetes=self.webpackChunkterranetes||[]).push([["2398"],{6805:function(e,t,r){r.r(t),r.d(t,{metadata:()=>i,contentTitle:()=>a,default:()=>h,assets:()=>l,toc:()=>c,frontMatter:()=>s});var i=JSON.parse('{"id":"workflows/platform","title":"Platform Team","description":"Setting up workflows","source":"@site/docs/terranetes-controller/workflows/platform.md","sourceDirName":"workflows","slug":"/workflows/platform","permalink":"/terranetes-controller/workflows/platform","draft":false,"unlisted":false,"editUrl":"https://github.com/appvia/terranetes/tree/master/docs/terranetes-controller/workflows/platform.md","tags":[],"version":"current","lastUpdatedBy":"dependabot[bot]","lastUpdatedAt":1745161752000,"sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"What are workflows","permalink":"/terranetes-controller/workflows/intro"},"next":{"title":"Developer","permalink":"/terranetes-controller/workflows/developer"}}'),n=r("5893"),o=r("65");let s={sidebar_position:2},a="Platform Team",l={},c=[{value:"Setting up workflows",id:"setting-up-workflows",level:2},{value:"Current Checks",id:"current-checks",level:3},{value:"On the Roadmap",id:"on-the-roadmap",level:3},{value:"Authoring a module",id:"authoring-a-module",level:2},{value:"Creating the Module",id:"creating-the-module",level:3},{value:"Incorporating Code",id:"incorporating-code",level:3},{value:"Publishing the Artifact",id:"publishing-the-artifact",level:3},{value:"Finding the Artifact",id:"finding-the-artifact",level:3}];function d(e){let t={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,o.a)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.header,{children:(0,n.jsx)(t.h1,{id:"platform-team",children:"Platform Team"})}),"\n",(0,n.jsx)(t.h2,{id:"setting-up-workflows",children:"Setting up workflows"}),"\n",(0,n.jsxs)(t.p,{children:["The ",(0,n.jsx)(t.code,{children:"terranetes-workflows"})," resides at ",(0,n.jsx)(t.a,{href:"https://github.com/appvia/terranetes-workflows",children:"https://github.com/appvia/terranetes-workflows"})]}),"\n",(0,n.jsxs)(t.p,{children:["To integrate the ",(0,n.jsx)(t.code,{children:"terranetes-workflows"})," into your organization's workflow, follow these steps:"]}),"\n",(0,n.jsxs)(t.ol,{children:["\n",(0,n.jsxs)(t.li,{children:["Clone the ",(0,n.jsx)(t.code,{children:"terranetes-workflows"})," repository into your organization's GitHub space and configure the repository settings to adhere to the ",(0,n.jsx)(t.a,{href:"https://docs.github.com/en/repositories/creating-and-managing-repositories/creating-a-new-repository",children:"GitHub Template"})," guidelines."]}),"\n",(0,n.jsxs)(t.li,{children:["If your organization maintains a centralized ",(0,n.jsx)(t.em,{children:"Checkov"})," policies repository, update the ",(0,n.jsx)(t.code,{children:"POLICY_SOURCE"})," and ",(0,n.jsx)(t.code,{children:"POLICY_VERSION"})," variables within the GitHub workflows to reference the repository and its tag (optional). In the absence of a central repository, the security checks will default to using the standard rules."]}),"\n",(0,n.jsxs)(t.li,{children:["To enable ",(0,n.jsx)(t.a,{href:"https://www.infracost.io/",children:"Infracost"})," integration, create an organizational secret named ",(0,n.jsx)(t.code,{children:"ORG_INFRACOST_API_KEY"}),". This will facilitate comments on pull requests, providing a detailed breakdown or diff of the predicted costs."]}),"\n"]}),"\n",(0,n.jsx)(t.h3,{id:"current-checks",children:"Current Checks"}),"\n",(0,n.jsx)(t.p,{children:"The template includes a comprehensive suite of GitHub workflows designed to evaluate and enforce various aspects of code quality and security. These workflows encompass:"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"Checkov Security Rules: Ensuring adherence to security best practices and identifying potential vulnerabilities."}),"\n",(0,n.jsx)(t.li,{children:"Code Format: Maintaining a consistent code structure and style across the project."}),"\n",(0,n.jsx)(t.li,{children:"Commit messages linting (consistent changelogs): Standardizing commit messages for clear and concise documentation of changes."}),"\n",(0,n.jsx)(t.li,{children:"Cost Estimations (Infracost): Providing detailed cost analysis and predictions for infrastructure deployments."}),"\n",(0,n.jsx)(t.li,{children:"Module Docs (terraform-docs): Generating and maintaining accurate documentation for Terraform modules."}),"\n",(0,n.jsx)(t.li,{children:"Terraform Code Validation: Verifying the correctness and validity of Terraform code."}),"\n"]}),"\n",(0,n.jsx)(t.p,{children:"At present, these workflows are specifically designed for GitHub Actions. However, there are plans to expand support to include GitLab and CircleCI in the future."}),"\n",(0,n.jsx)(t.h3,{id:"on-the-roadmap",children:"On the Roadmap"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"Implementation of scheduled jobs for periodic re-evaluation of security checks."}),"\n",(0,n.jsx)(t.li,{children:"Automation of pull request creation upon update of central policy."}),"\n"]}),"\n",(0,n.jsx)(t.h2,{id:"authoring-a-module",children:"Authoring a module"}),"\n",(0,n.jsx)(t.p,{children:"The following outlines the process of provisioning a new Terraform module using workflows."}),"\n",(0,n.jsx)(t.admonition,{type:"important",children:(0,n.jsx)(t.p,{children:"This is not a Terraform tutorial. For our purposes, we will be wrapping an existing module."})}),"\n",(0,n.jsx)(t.h3,{id:"creating-the-module",children:"Creating the Module"}),"\n",(0,n.jsxs)(t.p,{children:["To initiate the creation of a Terraform module, first ensure that the ",(0,n.jsx)(t.a,{href:"https://github.com/appvia/terranetes-workflows",children:"terranetes-workflows"})," repository has been cloned to a ",(0,n.jsx)(t.a,{href:"https://docs.github.com/en/repositories/creating-and-managing-repositories/creating-a-template-repository",children:"GitHub template"})," within your organization. This can be accomplished through the GitHub UI or by utilizing the ",(0,n.jsx)(t.a,{href:"https://github.com/cli/cli",children:"GitHub CLI"})," with the following command:"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-shell",children:"gh repo create appvia/terraform-aws-rds --template appvia/terranetes-workflows\n"})}),"\n",(0,n.jsxs)(t.p,{children:["It is essential to provide a suitable description for the repository, as this information is utilized by the ",(0,n.jsx)(t.a,{href:"/terranetes-controller/cli/tnctl_search",children:"tnctl search"})," command to facilitate filtering. This can be achieved with the following command:"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-shell",children:'gh repo edit appvia/terraform-aws-rds --description "Terraform module used to provision a RDS database"\n'})}),"\n",(0,n.jsxs)(t.p,{children:["Alternatively, the module can be replicated using the ",(0,n.jsx)(t.a,{href:"/terranetes-controller/cli/tnctl_workflow_create",children:"tnctl workflow create"})," command:"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-shell",children:"tnctl workflow create terraform-aws-rds --template URL\n"})}),"\n",(0,n.jsx)(t.h3,{id:"incorporating-code",children:"Incorporating Code"}),"\n",(0,n.jsx)(t.p,{children:"With the module created, you can now proceed to add the Terraform code. To do this, create a new branch and initiate a pull request:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-shell",children:"git checkout -b feat_adding_code\n# add code and commit\ngh pr create\n"})}),"\n",(0,n.jsx)(t.p,{children:"GitHub Actions will subsequently evaluate, review, and update the pull request with relevant comments."}),"\n",(0,n.jsx)(t.h3,{id:"publishing-the-artifact",children:"Publishing the Artifact"}),"\n",(0,n.jsxs)(t.p,{children:["Upon creation of a tag following the semantic versioning pattern (",(0,n.jsx)(t.code,{children:"v[SEMVER]"}),"), a GitHub release and changelog are automatically generated. This ensures that the artifact becomes instantly discoverable, provided the ",(0,n.jsx)(t.a,{href:"/terranetes-controller/cli/tnctl_search",children:"tnctl search"})," is configured to utilize your GitHub organization as a source."]}),"\n",(0,n.jsxs)(t.p,{children:["For publicly accessible repositories, the Terraform registry serves as a centralized platform for distributing, viewing, and searching for resources. Currently, this process must be performed on a per-repository basis. To initiate this process, navigate to ",(0,n.jsx)(t.a,{href:"https://registry.terraform.io/sign-in",children:"https://registry.terraform.io/sign-in"}),"."]}),"\n",(0,n.jsx)(t.p,{children:"In the case of private repositories, consider the following options:"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.a,{href:"https://github.com/outsideris/citizen",children:"https://github.com/outsideris/citizen"})}),"\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.a,{href:"https://github.com/SwissArmyRonin/terraform-aws-registry",children:"https://github.com/SwissArmyRonin/terraform-aws-registry"})}),"\n"]}),"\n",(0,n.jsx)(t.h3,{id:"finding-the-artifact",children:"Finding the Artifact"}),"\n",(0,n.jsxs)(t.p,{children:["Upon successful completion of the publishing process, the artifact should be accessible within your GitHub organization. To find the artifact, execute the command ",(0,n.jsx)(t.code,{children:"tnctl search rds"}),"."]})]})}function h(e={}){let{wrapper:t}={...(0,o.a)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(d,{...e})}):d(e)}},65:function(e,t,r){r.d(t,{Z:function(){return a},a:function(){return s}});var i=r(7294);let n={},o=i.createContext(n);function s(e){let t=i.useContext(o);return i.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:s(e.components),i.createElement(o.Provider,{value:t},e.children)}}}]);