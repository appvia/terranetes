"use strict";(self.webpackChunkterranetes=self.webpackChunkterranetes||[]).push([["9948"],{6768:function(e,t,n){n.r(t),n.d(t,{metadata:()=>s,contentTitle:()=>i,default:()=>h,assets:()=>c,toc:()=>l,frontMatter:()=>a});var s=JSON.parse('{"id":"admin/costs","title":"Expose Costs","description":"The cost integration feature enables developers to preview the associated costs before applying the terraform. This controller currently leverages infracost to predict the costs of a configuration, making the cost visible within the status of the Kubernetes object. This can be viewed by running kubectl get configuration.","source":"@site/docs/terranetes-controller/admin/costs.md","sourceDirName":"admin","slug":"/admin/costs","permalink":"/terranetes-controller/admin/costs","draft":false,"unlisted":false,"editUrl":"https://github.com/appvia/terranetes/tree/master/docs/terranetes-controller/admin/costs.md","tags":[],"version":"current","lastUpdatedBy":"dependabot[bot]","lastUpdatedAt":1745161655000,"sidebarPosition":5,"frontMatter":{"sidebar_position":5,"sidebar_class_name":"green"},"sidebar":"tutorialSidebar","previous":{"title":"Metrics","permalink":"/terranetes-controller/admin/observability/metrics"},"next":{"title":"Injecting Defaults","permalink":"/terranetes-controller/admin/defaults"}}'),r=n("5893"),o=n("65");let a={sidebar_position:5,sidebar_class_name:"green"},i="Expose Costs",c={},l=[{value:"View the predicted costs",id:"view-the-predicted-costs",level:2}];function d(e){let t={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",...(0,o.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"expose-costs",children:"Expose Costs"})}),"\n",(0,r.jsxs)(t.p,{children:["The cost integration feature enables developers to preview the associated costs before applying the terraform. This controller currently leverages ",(0,r.jsx)(t.a,{href:"https://infracost.io",children:"infracost"})," to predict the costs of a configuration, making the cost visible within the status of the Kubernetes object. This can be viewed by running ",(0,r.jsx)(t.code,{children:"kubectl get configuration"}),"."]}),"\n",(0,r.jsx)(t.admonition,{type:"tip",children:(0,r.jsx)(t.p,{children:"The costs displayed are predictions, not actual costs or usage. While many costs can be calculated based on the resource specifications alone, others are based on usage. For example, an S3 bucket may be free (predicted cost), but if you store 10TB inside it, you will accumulate data storage costs that would not be visible based on your Terraform resource spec."})}),"\n",(0,r.jsx)(t.p,{children:"To set up the integration:"}),"\n",(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsx)(t.p,{children:"Create a secret containing the Infracost API token."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"$ kubectl -n terraform-system create secret generic infracost \\\n  --from-literal=INFRACOST_API_KEY=$INFRACOST_API_KEY\n"})}),"\n"]}),"\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsx)(t.p,{children:"Configure the controller to enable infracost by updating the controller flag."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",children:"controller:\n  costs:\n    # The name of the secret you created in the controller namespace above\n    name: infracost\n"})}),"\n"]}),"\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsx)(t.p,{children:"Update the helm chart."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"$ helm upgrade terranetes-controller charts/\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(t.h2,{id:"view-the-predicted-costs",children:"View the predicted costs"}),"\n",(0,r.jsxs)(t.p,{children:["The predicted cost of a ",(0,r.jsx)(t.a,{href:"/terranetes-controller/reference/configurations.terraform.appvia.io",children:"Configuration"})," is accessible through the CRD status and resource description."]}),"\n",(0,r.jsx)(t.p,{children:"To view the predicted costs, execute the following command:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-shell",children:"$ kubectl -n apps get configurations\nNAME        MODULE                                                                    SECRET   RESOURCES   ESTIMATED   AGE\ninstance0   https://github.com/terraform-aws-modules/terraform-aws-ec2-instance.git                        $140.96     61s\ninstance1   https://github.com/terraform-aws-modules/terraform-aws-ec2-instance.git                        $1124.18    61s\ninstance2   https://github.com/terraform-aws-modules/terraform-aws-ec2-instance.git                        $136.288    61s\ninstance3   https://github.com/terraform-aws-modules/terraform-aws-ec2-instance.git                        $660.72     61s\n"})}),"\n",(0,r.jsx)(t.p,{children:"For more detailed information on the costs, including hourly and monthly estimates, you can query the status fields as follows:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-shell",children:'$ k -n apps get configurations.terraform.appvia.io  instance0 -o json | jq -r .status.costs\n{\n  "enabled": true,\n  "hourly": "$0.1930958904109589",\n  "monthly": "$140.96"\n}\n'})})]})}function h(e={}){let{wrapper:t}={...(0,o.a)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},65:function(e,t,n){n.d(t,{Z:function(){return i},a:function(){return a}});var s=n(7294);let r={},o=s.createContext(r);function a(e){let t=s.useContext(o);return s.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),s.createElement(o.Provider,{value:t},e.children)}}}]);