"use strict";(self.webpackChunkterranetes=self.webpackChunkterranetes||[]).push([["1205"],{2610:function(e,t,r){r.r(t),r.d(t,{metadata:()=>n,contentTitle:()=>i,default:()=>u,assets:()=>l,toc:()=>c,frontMatter:()=>s});var n=JSON.parse('{"id":"developer/flux","title":"Using Flux as Source","description":"Flux is a widely adopted and adaptable framework utilized for Gitops. Leveraging any Flux installation, you can fully utilize the feature set of the terraform controller.","source":"@site/docs/terranetes-controller/developer/flux.md","sourceDirName":"developer","slug":"/developer/flux","permalink":"/terranetes-controller/developer/flux","draft":false,"unlisted":false,"editUrl":"https://github.com/appvia/terranetes/tree/master/docs/terranetes-controller/developer/flux.md","tags":[],"version":"current","lastUpdatedBy":"dependabot[bot]","lastUpdatedAt":1745161655000,"sidebarPosition":4,"frontMatter":{"sidebar_position":4},"sidebar":"tutorialSidebar","previous":{"title":"Enabling Drift Protection","permalink":"/terranetes-controller/developer/drift"},"next":{"title":"Walk Throughs","permalink":"/terranetes-controller/category/walk-throughs"}}'),o=r("5893"),a=r("65");let s={sidebar_position:4},i="Using Flux as Source",l={},c=[];function d(e){let t={a:"a",admonition:"admonition",code:"code",h1:"h1",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",...(0,a.a)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.header,{children:(0,o.jsx)(t.h1,{id:"using-flux-as-source",children:"Using Flux as Source"})}),"\n",(0,o.jsxs)(t.p,{children:["Flux is a widely adopted and adaptable framework utilized for ",(0,o.jsx)(t.a,{href:"https://en.wikipedia.org/wiki/DevOps#GitOps",children:"Gitops"}),". Leveraging any Flux installation, you can fully utilize the feature set of the terraform controller."]}),"\n",(0,o.jsx)(t.admonition,{type:"important",children:(0,o.jsxs)(t.p,{children:["The following instructions assume that you have already installed the ",(0,o.jsx)(t.a,{href:"https://github.com/fluxcd/source-controller",children:"source-controller"})," and any dependent components in the cluster."]})}),"\n",(0,o.jsx)(t.p,{children:"Let's optimize our standard example to capitalize on Flux and source our terraform module through the source controller."}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-yaml",children:"apiVersion: terraform.appvia.io/v1alpha1\nkind: Configuration\nmetadata:\n  name: bucket\nspec:\n  module: https://github.com/terraform-aws-modules/terraform-aws-s3-bucket.git?ref=v3.1.0\n\n  providerRef:\n    name: default\n\n  writeConnectionSecretToRef:\n    name: test\n\n  variables:\n    bucket: [BUCKET_NAME]\n"})}),"\n",(0,o.jsxs)(t.ol,{children:["\n",(0,o.jsxs)(t.li,{children:["Instead of directly pulling the terraform module as shown above, we can utilize a ",(0,o.jsx)(t.a,{href:"https://fluxcd.io/docs/components/source/gitrepositories/",children:"GitRepository"})," to represent the source module."]}),"\n"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-yaml",children:"apiVersion: source.toolkit.fluxcd.io/v1beta2\nkind: GitRepository\nmetadata:\n  name: bucket\nspec:\n  interval: 1m\n  timeout: 60s\n  url: https://github.com/terraform-aws-modules/terraform-aws-s3-bucket.git\n"})}),"\n",(0,o.jsxs)(t.ol,{start:"2",children:["\n",(0,o.jsx)(t.li,{children:"Wait for the source controller to retrieve the module and view the status."}),"\n"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-shell",children:"$ kubectl get gitrepositories bucket -o yaml\n"})}),"\n",(0,o.jsxs)(t.ol,{start:"3",children:["\n",(0,o.jsx)(t.li,{children:"Examine the status of the resource."}),"\n"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-yaml",children:"status:\n  artifact:\n    ...\n  observedGeneration: 2\n  url: http://source-controller.source-system.svc.cluster.local./gitrepository/apps/terraform-aws-s3-bucket.git/latest.tar.gz\n"})}),"\n",(0,o.jsxs)(t.ol,{start:"4",children:["\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsx)(t.p,{children:"Note that the URL will vary depending on the namespace in which the source controller was installed and any branch references."}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsxs)(t.p,{children:["Update your ",(0,o.jsx)(t.a,{href:"/terranetes-controller/reference/configurations.terraform.appvia.io",children:"Configuration"})," resource to use the above URL. Note that we have to force the protocol type by prefixing it with ",(0,o.jsx)(t.code,{children:"http::"})]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-yaml",children:"apiVersion: terraform.appvia.io/v1alpha1\nkind: Configuration\nmetadata:\n  name: bucket\nspec:\n  module: http::http://source-controller.source-system.svc.cluster.local/gitrepository/apps/terraform-aws-s3-bucket.git/latest.tar.gz\n"})}),"\n",(0,o.jsx)(t.p,{children:"The controller will retrieve and extract the archive for you."}),"\n",(0,o.jsx)(t.admonition,{type:"important",children:(0,o.jsx)(t.p,{children:"These steps do not need to be performed sequentially. Once you know the expected format of the URL that the source controller is going to provide, you can apply the resources all at once."})})]})}function u(e={}){let{wrapper:t}={...(0,a.a)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},65:function(e,t,r){r.d(t,{Z:function(){return i},a:function(){return s}});var n=r(7294);let o={},a=n.createContext(o);function s(e){let t=n.useContext(a);return n.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),n.createElement(a.Provider,{value:t},e.children)}}}]);